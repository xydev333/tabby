language: node_js
node_js: 11

stages:
  - Docs

jobs:
  include:
    - stage: 'Docs'
      os: linux
      if: branch = master
      script:
        - set -e
        - openssl aes-256-cbc -K $encrypted_4e2fb4889ef8_key -iv $encrypted_4e2fb4889ef8_iv -in .travis.ssh.key.enc -out .travis.ssh.key -d
        - eval "$(ssh-agent -s)"
        - chmod 600 .travis.ssh.key
        - ssh-add .travis.ssh.key
        - yarn
        - yarn run docs
        - rsync -e "ssh -o StrictHostKeyChecking=no" -arv docs/api/ root@ajenti.org:/srv/terminus-docs/

dist: xenial
sudo: false

addons:
  apt:
    packages:
    - rpm
    - yarn
    - libsecret-1-dev
    sources:
    - sourceline: 'deb https://dl.yarnpkg.com/debian/ stable main'
      key_url: 'https://dl.yarnpkg.com/debian/pubkey.gpg'

cache:
  directories:
  - 'terminus-*/node_modules'
  - $HOME/.cache/yarn
  - $HOME/.cache/electron
  - $HOME/.cache/electron-builder
